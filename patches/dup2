Bottom: d24dd0fae6823a86b3a40de76ff29ff00831ae09
Top:    5770132465e02e074374c2198a8f7ee3aad036ea
Author: Sean Hefty <sean.hefty@intel.com>
Date:   2012-07-30 16:06:32 -0700

rspreload: Support dup2 calls

vsftpd requires dup2() support.  To handle dup2, we need to add
reference count tracking to the preload fd's.

Signed-off-by: Sean Hefty <sean.hefty@intel.com>


---

diff --git a/src/preload.c b/src/preload.c
index 52eaf1a..e230a56 100644
--- a/src/preload.c
+++ b/src/preload.c
@@ -886,3 +886,10 @@ int fcntl(int socket, int cmd, ... /* arg */)
 	va_end(args);
 	return ret;
 }
+
+int dup2(int oldfd, int newfd)
+{
+	int fd;
+	return (fd_get(oldfd, &fd) == fd_rsocket) ?
+		: dup2(oldfd, newfd);
+}
